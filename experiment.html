<!DOCTYPE html>
<html>
    <head>
        <title>My experiment</title>
        <script src="jspsych-6.0.5/jspsych.js"></script>
        <!-- <script src="jspsych-6.0.5/plugins/jspsych-html-keyboard-response.js"></script> -->
        <!-- Below to be deleted -->
        <!-- <script src="jspsych-6.0.5/plugins/jspsych-image-button-response.js"></script> -->
        <script src="jspsych-ab-test.js"></script>
        <link href="jspsych-6.0.5/css/jspsych.css" rel="stylesheet" type="text/css"></link>
        <link href="custom.css" rel="stylesheet" type="text/css"></link>
    </head>
    <body></body>
    <script>

      var timeline = [];

      // Hardcoded file list because of client code.
      var images = ['img/20181025215535_487_evaluated_target_17.png', 'img/20180718164411_15_evaluated_target_17.png'];

      // Code from https://rosettacode.org/wiki/Combinations#JavaScript
      function combinations(arr, k){
          var i,
          subI,
          ret = [],
          sub,
          next;
          for(i = 0; i < arr.length; i++){
              if (k === 1) {
                  ret.push( [ arr[i] ] );
              } else {
                  sub = combinations(arr.slice(i+1, arr.length), k-1);
                  for(subI = 0; subI < sub.length; subI++ ){
                      next = sub[subI];
                      next.unshift(arr[i]);
                      ret.push( next );
                  }
              }
          }
          return ret;
      }


      // Code from https://stackoverflow.com/a/12646864/3853537
      function shuffleArray(array) {
          for (let i = array.length - 1; i > 0; i--) {
              const j = Math.floor(Math.random() * (i + 1));
              [array[i], array[j]] = [array[j], array[i]];
          }
          return array;
      }

        // Get all two-combinations (order doesn't matter) of all candidates.
        // n(n-1)/2
      function generateTrials(images) {
        var two_combinations = combinations(images, 2);
        var trials = two_combinations.map(two_images => (
          {
            type: 'ab-test',
            images: shuffleArray(two_images),
            prompt: "<p>Click on the better image, or 'They are similar' if there is no clear winner</p>",
          }
        ))
        return trials;
      }

      var trials = generateTrials(images);
      trials.forEach(trial => {
        console.log(trial);
      })
      timeline = timeline.concat(trials);

      // var ab_test_0 = {
      //   type: 'ab-test',
      //   // stimulus: 'img/20181025215535_487_evaluated_target_17.png',
      //   // stimuli: stimuli,
      //   images: stimuli,
      //   prompt: "<p>Click on the better image, or 'They are similar' if there is no clear winner</p>",
      // }

      // timeline.push(trial);
      // timeline.push(ab_test_1);

      // var ab_test_0 = {
      //   type: 'ab-test',
      //   // stimulus: 'img/20181025215535_487_evaluated_target_17.png',
      //   // stimuli: stimuli,
      //   images: stimuli,
      //   prompt: "<p>Click on the better image, or 'They are similar' if there is no clear winner</p>",
      // }
      //
      // // timeline.push(trial);
      // timeline.push(ab_test_1);

      jsPsych.init({
          timeline: timeline
      })

    </script>
</html>
